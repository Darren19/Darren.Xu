# 1. 基础数据

## 1.1 公司管理

### 1.1.1 子公司

在OI中维护公司架构。

与NS对接时，需要设置映射关系，指定NS中子公司的名称和内部序号即可。

### 1.1.2 部门

在OI中维护部门结构。

与NS对接时，需要设置映射关系，指定NS中部门的名称和内部序号即可。

* 不能设置部门的上级部门。

### 1.1.3 员工

在OI中维护员工。

与NS对接时，需要设置映射关系，指定NS中员工的名称和内部序号即可。**这里有一个问题点，在OI中员工资料是可以在子公司间共享的，而在NS中员工是子公司独享的，所以这里的映射关系应该再加上子公司才可以。**

## 1.2 渠道分配规则和商品分配

### 1.2.1 店铺

设置店铺时，要注意选择的子公司；通常来讲，都是香港子公司，而不是上海的子公司；需要指定对应的部门，这些部门在NS中作为成本和利润中心。

需要绑定亚马逊或易贝账号。授权TOKEN会过期，在过期前需要调用刷新接口，以便授权能够继续有效。

### 1.2.2 仓库

如果是第三方仓库，需要在【授权】字段中选择集成的第三方仓库。

第三方仓库如果是FBA仓库，则只需要绑定对应的店铺即可；绑定非FBA仓库时，需要输入账号和密码。

仓库中如果启用库位管理，需要启用【库位状态】。

【货主模式】中的【供应链模式】允许一个仓库向多个店铺或门店供货；如果选择了【普通模式】，那么此仓库只能向一个店铺或门店供货。

仓库设置完毕后，还需要设置货主和仓库的绑定关系，否则也不能入库。

### 1.2.3 商品分配



操作商品分配之前，需要设定渠道销售价格和渠道库存分配规则，还需要设置OI中商品代码与现有渠道商品的映射关系。这是因为通常情况下，使用OI时，客户的店铺已经在运营，商品在平台上已经有了渠道商品代码，如亚马逊的FNSKU。这种情况下，我们需要将商品代码和现有渠道商品代码对应起来。这样转单，还有拉取库存的时候，平台和OI系统才能对应起来。

商品分配时，勾选【仅分配库存】时，系统不会生成商品标识，只会更新渠道库存。商品分配时，【发布库存百分比】和【发布库存数值】两者选其一即可。这两个字段是在原有库存的基础上，额外增加的库存，这点要注意。

同步第3方仓库库存后，需要同时更新渠道库存，不能只更新OI的库存数据；这个需求目前还未实现。

## 1.1 货品

### 1.1.1 货品同步注意事项

1. NS同步的货品资料，其类型均为启用批次的库存货品。同步至OI后，需要默认勾选普通商品的【商品批次号】和【自动生成批次】字段。

2. OI中【产品编码】字段只能由字母、数字和下划线组成。这点与雅耶目前在NS中使用的编码规则不一致，需要Mark在导入新产品时，更新NS中的货品编码，与OI中的产品编码规则保持一致。如果不一致，当前也没有关系，但是不能在OI中编辑普通产品，否则无法保存。

3. NS中的【产品编码】字段必须填写，【显示名称】字段必须填写，【可售】字段必须勾选，否则无法同步至OI。

4. 货品如果同属一个产品的话，将NS中的【产品编码】字段设置为一样的即可。

5. NS中货品的成本计算方式设置为批次成本。

6. 货品如果需要启用质检，在NS中勾选【是否质检】字段，同步至OI后会默认勾选【商品质检】字段。OI中的【质检百分比】字段暂时不用同步，因为它不控制质检过程中的比例。

7. 定时同步脚本默认10分钟运行1次，可以由开发配置同步间隔。若需要OI实时同步，需要在普通产品界面手工点击【同步】。

8. 需要启用多单位，还未同步启用；

需要确认子公司范围在两个系统内是否一致；

# 2. 业务流程

## 2.1 采购正向

审批通过的采购订单同步至OI，所以同步过来至OI的采购订单默认为已审核的，无需人工审核；

在采购入库到某个仓库之前，需要先绑定仓库的货主；通常货主即为仓库对应的子公司。

是否允许采购订单超入，由仓库的【是否入库超出】字段决定的。

采购异常通知处理之后，仓库需要再次执行入库任务，不能直接做上架任务。

是否允许不同的货品使用同一个批次，是由库位的【是否混批次】字段决定的。

质检人员先进行质检，使用质检管理功能；采购人员接着处理质检异常通知；之后，质检人员再次使用质检管理功能进行质检，并进行上架或集货区销毁动作。

在NS中新建的仓库不使用库位；在并行期间，没有上线的公司仓库继续启用库位。

## 2.2 B2C流程

订单抓取之后，是在缓存订单中；只有商品编码与渠道商品编码一致的情况下，才能自动转为正式订单。

亚马逊订单自动转单之后，会自动审核通过，不需要人为审核。

在编辑正式订单时，会提示【平台下单时间】为空；

审核亚马逊订单时，必须输入配送信息，目前的缓存订单为空；

转为正式订单后，缓存订单的配送信息丢失了。

【第三方仓库编码】字段目前没有用途，只是备注字段，还没有与第3方仓库做关联。

发布库存数量大于0才可以新建订单；如果实际库存为0，可以手工修改发布数量。恒定库存发布的优先级高于发布数量。

渠道、公司、客户、货币、快递、仓库、配送电话、配送地址，如果开发的话发票信息必须全部一致，系统会自动执行合单。

商品刊登前，要先设置渠道销售价格和渠道库存分配规则。

订单审批队列还未配置，目前只能手工发货。

审核销售订单时，最好能够有验证，这样可以避免调用接口时有异常错误。

FBA的发货单同步时必须有邮编，但是抓取EBAY订单时遗漏了此字段。

FBA的发货记录还没有同步过来。

### 2.2.1 测试数据

店铺：EBAY-04-D106-factoryqueen

原始订单号：163429315210-1928113481006；

货品：NY-8067；

操作失败：新建发货单-库存第三方处理失败-warehouse_id参数缺失