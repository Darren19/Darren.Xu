# 匹配采购订单自动生成账单

## 0. 账号和环境信息

选项 | 内容
---|---
开发环境 | 雅耶SANDBOX 
用户名	| 
密码	| 
密保答案 | 

# 1. 需求基本信息

信息选项 | 内容
---|---
优先级 | 高 
需求提交日期 | 2019-10-21 
需求完成日期 |  

# 2. 需求概述

跟单人员和财务人员在核对供应商开具的采购发票和采购合同的内容时，工作量巨大，而且容易出错。处理不及时，或者出错，就会影响公司的出口退税。为了减轻用户的手工工作量，同时提高匹配的准确性，所以有了本次开发方案。

供应商提供的纸质采购发票，需要扫描并导入到NS中记录下来。这部分工作由雅耶的开发人员完成。云合负责根据导入的发票记录，匹配系统内的采购订单，并自动生成账单。

# 3. 工时

预估工时 | 确认工时
---|---
小时 | 小时 

# 4. 详细需求

## 4.1 系统发票记录

导入的发票记录字段分为表体和明细行字段。

需要记录的表体字段为：

|   字段名称   |  格式  |             备注             |
| :----------: | :----: | :--------------------------: |
|   发票号码   |  文本  |                              |
|   开票日期   |  日期  |                              |
|    供应商    |  列表  |                              |
| 纳税人识别号 |  文本  |                              |
|   采购合同   |  文本  |   用于匹配系统内的采购订单   |
|    已匹配    | 单选框 | 用于标记是否已经匹配生成账单 |

需要记录的明细行字段为：

| 字段名称 | 格式 |        备注        |
| :------: | :--: | :----------------: |
| 开票品名 | 文本 |                    |
| 规格型号 | 文本 |                    |
|   数量   | 小数 |                    |
|   单位   | 列表 | 从系统的单位中选取 |
|   单价   | 货币 |                    |
|   税额   | 货币 |                    |
|   金额   | 货币 |                    |

## 4.2 匹配操作

用户打开匹配界面后，点击【载入发票】，系统自动载入所有未成功匹配的发票记录，并根据采购合同匹配系统内的采购订单，继而展示匹配结果。如果载入发票过多会影响用户操作体验时，可以默认只载入固定数量的发票记录，例如10张。具体设置哪个数字，需要在测试的过程中确定下来。

系统首先匹配表体中的【供应商】和【纳税人识别号】，接着匹配明细行中的所有字段。如果这些字段全部匹配成功，则以正常颜色显示。如果某些字段无法匹配，则系统以黄底显示，提示用户去修改采购合同，或者要求供应商重开发票。

用户点击【提交】，系统根据完全匹配的发票记录，生成系统的账单。这里的完全匹配是指，表体中的【供应商】、【纳税人识别号】和明细行中的所有字段，都必须匹配；而且本张采购发票记录所有的明细行都得到匹配，不能有部分匹配的情况。只有满足了完全匹配，系统才能够生成账单。生成账单后，系统勾选采购发票的【已匹配】字段。

## 4.3 后续操作

用户可以根据报表查看，哪些导入的发票记录还没有匹配生成账单。

系统也可以自动发送邮件，提醒跟单员去匹配这些采购发票。

# 5 签字

| 上海朗探 | 上海云合 |
| -------- | :------- |
| 签字：   | 签字：   |
| 日期：   | 日期：   |

# 6. 疑问

1. 供应商的货品如何与系统进行匹配？是否需要制作匹配表？
2. 是否存在部分开票的情形？什么情形下认为是完全匹配的？
3. 合并开票如何处理？如何在多张采购合同中分配数量？