```flow
开始=>start: 开始
发票=>operation: 发票
出口退税记录=>operation: 出口退税记录
货品收据=>operation: 货品收据（入库单价，计算预估退税金额）
账单=>operation: 账单（发票单价，计算实际退税金额）
后到账单=>operation: 账单
匹配出口退税=>operation: 匹配出口退税（匹配发票单价，更新实际退税金额）
出口退税日记账=>operation: 出口退税日记账
调整出口退税=>operation: 调整出口退税
退税成本日记账=>operation: 退税成本日记账
红冲日记账=>operation: 红冲日记账
标记已调整=>operation: 标记已调整
标记未调整=>operation: 标记未调整
已开账单=>condition: 已开账单
有发票号=>condition: 有发票号
结束=>end: 结束

开始->货品收据->已开账单
已开账单(yes)->账单->发票
已开账单(no)->匹配出口退税->发票
发票->出口退税记录->出口退税日记账->有发票号
有发票号(yes)->退税成本日记账->标记已调整
有发票号(no)->标记未调整(right)->调整出口退税(right)->红冲日记账(right)->出口退税日记账
```

# 出口退税测试记录

发票链接为：https://5151251-sb1.app.netsuite.com/app/accounting/transactions/custinvc.nl?id=10500263&whence=

共有2个批次，20191201和20191202。

## 账单在发票之前

20191201，这个批次的账单在发票之前。

它的账单链接为：https://5151251-sb1.app.netsuite.com/app/accounting/transactions/vendbill.nl?id=10499962&whence=&cmid=1575857638649_778

保存发票的时候【退税率（实际）】字段没有值；

要记录部门、地点和类字段，并同步到日记账记录上；

出口退税日记账也没有回写到出口退税记录上；

## 账单在发票之后

20191202，这个批次的账单在发票之后。

它的采购订单链接为：https://5151251-sb1.app.netsuite.com/app/accounting/transactions/purchord.nl?id=10499860&whence=&cmid=1575857208840_748

它的货品收据链接为：https://5151251-sb1.app.netsuite.com/app/accounting/transactions/itemrcpt.nl?id=10499961&whence=&cmid=1575857480407_767

每次测试时，需要手工创建账单。

【上税率（实际）】字段应该为空；

**出口退税记录中，需要添加一个字段，出口退税日记账（预估），与实际的出口退税日记账进行区别；**

匹配发票的界面等到功能完成后再进行调整；

没有勾选【已调整出口退税】，也没有回写调整出口退税日记账单据号码到出口退税记录中；